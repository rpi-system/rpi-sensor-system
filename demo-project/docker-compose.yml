networks:
  influxdb:

services:
  # influxdb:
  #   image: influxdb:latest
  #   container_name: influxdb
  #   ports:
  #     - "8083:8083"
  #     - "8086:8086"
  #     - "8090:8090"
  #     - "2003:2003"
  #   networks:
  #     - influxdb
  #   env_file:
  #     - 'env.influxdb'
   # volumes:
      # Data persistency
      # sudo mkdir -p /srv/docker/influxdb/data
      # - ./srv/docker/influxdb/data:/var/lib/influxdb

  # telegraf:
  #   image: telegraf:latest
  #   container_name: telegraf
  #   networks:
  #     - influxdb
  #   volumes:
  #     - ./telegraf.conf:/etc/telegraf/telegraf.conf:ro

  # grafana:
  #   image: grafana/grafana:latest
  #   container_name: grafana
  #   ports:
  #     - "3000:3000"
  #   networks:
  #     - influxdb
  #   env_file:
  #     - 'env.grafana'
  #   user: "0"
  #   links:
  #     - influxdb
  #   volumes:
  #     # Data persistency
  #     # sudo mkdir -p /srv/docker/grafana/data; chown 472:472 /srv/docker/grafana/data
  #     - /srv/docker/grafana/data:/var/lib/grafana

  app:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: python-app
    environment:
      - DATABASE_URL=''
    ports:
      - "8000:8000"  # Expose port 8000 for the app (if needed for other services)


  influxdb2:
    image: influxdb:latest
    ports:
      - 8086:8086
    environment:
      DOCKER_INFLUXDB_INIT_MODE: setup
      DOCKER_INFLUXDB_INIT_USERNAME_FILE: /run/secrets/influxdb2-admin-username
      DOCKER_INFLUXDB_INIT_PASSWORD_FILE: /run/secrets/influxdb2-admin-password 
      DOCKER_INFLUXDB_INIT_ADMIN_TOKEN_FILE: /run/secrets/influxdb2-admin-token
      DOCKER_INFLUXDB_INIT_ORG: docs 
      DOCKER_INFLUXDB_INIT_BUCKET: home
    secrets:
      - influxdb2-admin-username
      - influxdb2-admin-password
      - influxdb2-admin-token
    volumes:
      - type: volume
        source: influxdb2-data
        target: /var/lib/influxdb2
      - type: volume
        source: influxdb2-config
        target: /etc/influxdb2

secrets:
  influxdb2-admin-username:
    file: ./.env.influxdb2-admin-username
  influxdb2-admin-password:
    file: ./.env.influxdb2-admin-password
  influxdb2-admin-token:
    file: ./.env.influxdb2-admin-token

volumes:
  influxdb2-data:
  influxdb2-config:


 # influxdb_data: 
 #   driver: local